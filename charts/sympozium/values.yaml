# -- Global image settings
image:
  registry: ghcr.io/alexsjones/sympozium
  pullPolicy: IfNotPresent
  # -- Override the image tag (defaults to .Chart.AppVersion)
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# -- Namespace to deploy into (created if it doesn't exist)
namespace: sympozium-system

# -- Controller (reconciles CRDs, manages agent pods)
controller:
  replicas: 1
  image:
    repository: ""  # defaults to {{ .Values.image.registry }}/controller
    tag: ""
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  leaderElect: true
  nodeSelector: {}
  tolerations: []
  affinity: {}

# -- API Server (REST API for TUI/CLI and channel deployments)
apiserver:
  replicas: 1
  image:
    repository: ""  # defaults to {{ .Values.image.registry }}/apiserver
    tag: ""
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  service:
    type: ClusterIP
    port: 8080
  # -- Web UI settings
  webUI:
    # -- Enable the embedded web dashboard
    enabled: true
    # -- Bearer token for API/UI authentication.
    # If empty, a random token is generated and stored in a Secret.
    # Retrieve it with: kubectl get secret <release>-ui-token -n <ns> -o jsonpath='{.data.token}' | base64 -d
    token: ""
  nodeSelector: {}
  tolerations: []
  affinity: {}

# -- Webhook (admission controller for policy enforcement)
webhook:
  enabled: true
  replicas: 2
  image:
    repository: ""  # defaults to {{ .Values.image.registry }}/webhook
    tag: ""
  resources:
    limits:
      cpu: 200m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi
  nodeSelector: {}
  tolerations: []
  affinity: {}

# -- NATS JetStream (event bus for agent IPC)
nats:
  # -- Deploy built-in NATS. Set to false if using an external NATS cluster.
  enabled: true
  image:
    repository: nats
    tag: 2-alpine
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 64Mi
  # -- External NATS URL (used when nats.enabled=false)
  externalUrl: ""
  persistence:
    enabled: false
    size: 1Gi
    storageClass: ""
  nodeSelector: {}
  tolerations: []
  affinity: {}

# -- cert-manager integration for webhook TLS
certManager:
  # -- Requires cert-manager to be installed in the cluster
  enabled: true
  issuer:
    # -- Use "ClusterIssuer" for cluster-wide, "Issuer" for namespace-scoped
    kind: Issuer
    name: sympozium-selfsigned
    selfSigned: true
  certificate:
    duration: 8760h    # 1 year
    renewBefore: 720h  # 30 days

# -- CRD installation
crds:
  # -- Install CRDs with the chart. Disable if managing CRDs separately.
  install: true

# -- RBAC
rbac:
  # -- Create ClusterRole, ClusterRoleBinding, and ServiceAccounts
  create: true

# -- Network policies for agent pod isolation
networkPolicies:
  # -- Deploy default network policies (deny-all + allow-eventbus for agents)
  enabled: true

# -- Default SympoziumPolicies to install (permissive, restrictive, network-isolated)
defaultPolicies:
  # -- Install built-in policy presets
  enabled: true

# -- Default SkillPacks to install (code-review, incident-response, k8s-ops, sre-observability)
defaultSkills:
  enabled: true
  # -- List of SkillPack specs
  skills: []

# -- Pod security context (applied to all control plane pods)
securityContext:
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

# -- Container security context (applied to all control plane containers)
containerSecurityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop: ["ALL"]

# -- ServiceMonitor for Prometheus (requires prometheus-operator)
serviceMonitor:
  enabled: false
  interval: 30s
  labels: {}

# -- Built-in OpenTelemetry collector (enabled by default)
observability:
  enabled: true
  collector:
    image:
      repository: otel/opentelemetry-collector
      tag: "0.104.0"
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi
    service:
      otlpGrpcPort: 4317
      otlpHttpPort: 4318
      metricsPort: 8889
      healthPort: 13133
  defaultInstance:
    enabled: true
    otlpEndpoint: "sympozium-otel-collector.sympozium-system.svc:4317"
    otlpProtocol: "grpc"
    serviceName: "sympozium"
    resourceAttributes:
      deployment.environment: "cluster"
      k8s.cluster.name: "unknown"
